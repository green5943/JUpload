+function(f){var l,m;f.event.props.push("dataTransfer");f.fn.JUpload=function(e){var a;a=new XMLHttpRequest;return this.each(function(b){if(a.upload)return new m(b,f(this),e)})};m=function(){function e(a,b,c){var d,e,h,g,k=this;d={serverUrl:b.closest("form").attr("action")};this.settings=f.extend(d,c);this.existFiles=[];c=0<b.closest("form").length?b.closest("form"):b.parent();c.find("button[type='submit']").hide();this.settings.fileContainer?this.settings.fileContainer=f(a<=this.settings.fileContainer.length-
1?this.settings.fileContainer[a]:this.settings.fileContainer[this.settings.fileContainer.length-1]):(this.settings.fileContainer=f("<div class='fileContainer'></div>"),c.after(this.settings.fileContainer));b.on("change",f.proxy(this.fileSeclectHandler,this));this.settings.dragSupport&&(c.on("dragover dragleave",this.fileDragHandler),this.settings.fileContainer.on("dragover dragleave",this.fileDragHandler),c.on("drop",f.proxy(this.fileSeclectHandler,this)),this.settings.fileContainer.on("drop",f.proxy(this.fileSeclectHandler,
this)));if(this.settings.extFilter){c="";g=this.settings.extFilter.split("|");e=0;for(h=g.length;e<h;e++)d=g[e],c=c+"."+d+",";b.attr("accept",c.substr(0,c.length-1))}this.settings.folderUpload&&b.attr("webkitdirectory",!0).attr("directory",!0);this.settings.customInput&&(a=this.settings.folderUpload?"<button class='btn btn-info btn-sm btn-custom btn-custom"+(a+1)+"'><i class='fa fa-folder-open'></i> Choose Folder</button>":"<button class='btn btn-info btn-sm btn-custom"+(a+1)+"'><i class='fa fa-file'></i> Choose Files</button>",
b.addClass("hidden").after(a).next("button").on("click",function(a){a.preventDefault();return b.click()}));this.settings.batchControl&&(this.settings.fileContainer.prepend("<div class='alert alert-info batchop'>                                        <button class='btn btn-info btn-xs playall'><i class='fa fa-play'> UPLOAD ALL</i></button>                                        <button class='btn btn-info btn-xs pauseall'><i class='fa fa-pause'> PAUSE ALL</i></button>                                        <button class='btn btn-info btn-xs closeall'><i class='fa fa-times'> CLOSE ALL</i></button>                                        </div>"),
this.batchop=this.settings.fileContainer.find(".batchop"),this.batchop.on("click",".playall",function(){return k.settings.fileContainer.find(".play").click()}),this.batchop.on("click",".pauseall",function(){return k.settings.fileContainer.find(".pause").click()}),this.batchop.on("click",".closeall",function(){k.settings.fileContainer.find(".close").click();return b.val("")}))}e.prototype.fileDragHandler=function(a){a.stopPropagation();a.preventDefault();return f(a.target).toggleClass("dragHover",
"dragover"===a.type)};e.prototype.fileSeclectHandler=function(a){var b,c,d,e,h,g;"drop"===a.type&&this.fileDragHandler(a);c=a.target.files||a.dataTransfer.files;if(this.settings.maxNumberFiles<this.existFiles.length+c.length)return this.settings.fileContainer.prepend("<div class='alert alert-warning'>Exceeded the limit number of files. Please choose less files.</div>").find(".alert:first").fadeIn().delay(2E3).fadeOut();g=[];e=0;for(h=c.length;e<h;e++)b=c[e],d=!0,0===b.name.trim().indexOf(".")&&(d=
!1),d&&f.each(this.existFiles,function(a,c){if(JSON.stringify(c)===JSON.stringify(b))return d=!1}),d?(this.existFiles.push(b),1<this.existFiles.length&&this.settings.batchControl&&this.batchop.fadeIn(),a=new l(b,this.settings),a.fileUploadView.delay(200*(4>=e?e:5)).fadeIn(),g.push(this.fileRemoveHandler(a))):g.push(void 0);return g};e.prototype.fileRemoveHandler=function(a){var b=this;return a.fileUploadView.find(".close").on("click",function(){a.fileUploadView.fadeOut(500,function(){return this.remove()});
2>=b.existFiles.length&&b.settings.batchControl&&b.batchop.fadeOut();return f.each(b.existFiles,function(c,d){if(JSON.stringify(d)===JSON.stringify(a.file))return!b.existFiles.splice(c,1)})})};return e}();l=function(){function e(a,b){this.file=a;this.settings=b;this.fileUploadView=f("<div class='alert alert-info'>                          <button type='button' class='close'>\u00d7</button>                          <button class='btn btn-default btn-xs play' disabled><i class='fa fa-play'> UPLOAD</i></button>                          <button class='btn btn-default btn-xs pause' disabled><i class='fa fa-pause'> PAUSE</i></button>                          <span class='ptext'>0%</span><i class='fa fa-cog fa-spin' style='display:none'></i><div class='progress'>                          <div class='finfo'>"+
this.file.name+" ("+this.convertSize()+")</div>                          <div class='progress-bar'></div></div></div>");this.playBtn=this.fileUploadView.find(".play");this.pauseBtn=this.fileUploadView.find(".pause");this.ptxt=this.fileUploadView.find(".ptext");this.cog=this.fileUploadView.find(".fa-cog");this.pgCnt=this.fileUploadView.find(".progress");this.inf=this.fileUploadView.find(".finfo");this.pgBar=this.fileUploadView.find(".progress-bar");this.settings.fileContainer.append(this.fileUploadView);
this.checkFile()}e.prototype.convertSize=function(){var a;a=this.file.size.toString().length;return 6>=a?(this.file.size/1024).toFixed(2)+"KB":6<a&&9>=a?(this.file.size/1024/1024).toFixed(2)+"MB":(this.file.size/1024/1024/1024).toFixed(2)+"GB"};e.prototype.checkFile=function(){var a,b,c=this;a=!0;this.settings.extFilter&&(a=this.file.name.substr((~-this.file.name.lastIndexOf(".")>>>0)+2),b=RegExp(this.settings.extFilter,"ig"),a=b.test(a));this.settings.maxSize&&(a=this.file.size<this.settings.maxSize);
if(a)return this.playBtn.on("click",f.proxy(this.sendData,this)),this.checkServerFile();this.ptxt.text("Unsupported file!");this.fileUploadView.removeClass("alert-info").addClass("alert-warning");return setTimeout(function(){return c.fileUploadView.find(".close").click()},2E3)};e.prototype.checkServerFile=function(){var a;a=this;return f.getJSON(this.settings.serverUrl,{filename:this.file.name,filesize:this.file.size,lastModifiedDate:this.file.lastModifiedDate},function(b){return a.setView(b)})};
e.prototype.setView=function(a){this.playBtn.removeAttr("disabled");a.exist&&(this.fid=a.id,this.fcurrentSize=a.currentSize,this.fprogress=(this.fcurrentSize/this.file.size*100).toFixed(2)+"%",this.pgBar.css("width",this.fprogress),this.ptxt.text(this.fprogress));if(this.settings.autoStart&&!a.exist||this["break"])return this.sendData()};e.prototype.sendData=function(){var a,b,c,d=this;a=new FormData;b="";this.fcurrentSize?(a.append("slice",this.file.slice(this.fcurrentSize,this.file.size)),b=this.settings.serverUrl+
"/"+this.fid):(this.fcurrentSize=0,a.append("filesize",this.file.size),a.append("lastModifiedDate",this.file.lastModifiedDate),a.append("file",this.file),b=this.settings.serverUrl);c=new XMLHttpRequest;c.upload.addEventListener("loadstart",function(a){d.playBtn.off("click").attr("disabled","disabled");d.pauseBtn.on("click",function(){return c.abort()}).removeAttr("disabled");d.cog.fadeIn();d.pgCnt.addClass("progress-striped active");return d.pgBar.removeClass("progress-bar-warning")});c.upload.addEventListener("progress",
function(a){a=((a.loaded+d.fcurrentSize)/(a.total+d.fcurrentSize)*100).toFixed(2)+"%";d.pgBar.css("width",a);return d.ptxt.text(a)});c.upload.addEventListener("abort",f.proxy(this.breakUpload,this));c.upload.addEventListener("error",f.proxy(this.breakUpload,this));c.upload.addEventListener("loadend",function(a){d.cog.fadeOut();d.pgCnt.removeClass("progress-striped active");return d.pauseBtn.off("click").attr("disabled","disabled")});c.open("POST",b,!0);try{c.send(a)}catch(e){breakUpload()}return c.addEventListener("readystatechange",
function(a){if(4===c.readyState&&200===c.status)return d.pgBar.addClass("progress-bar-success"),d.inf.wrapInner("<a target='_blank' href='"+d.settings.serverUrl+"/"+c.responseText+"'></a>")})};e.prototype.breakUpload=function(){var a=this;this.cog.fadeOut();this.pauseBtn.off("click").attr("disabled","disabled");this.playBtn.on("click",function(){return a.checkServerFile()}).removeAttr("disabled");this.pgCnt.removeClass("progress-striped active");this.pgBar.addClass("progress-bar-warning");return this["break"]=
!0};return e}();return f(document).on("click.JUpload",'[data-plugin="JUpload"]',function(){return f(this).JUpload()})}(jQuery);
